<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="attendance">
	
	<!-- 사원 근태 기록 조회(일별) -->
	<select id="memAttendance" resultType="com.kh.coreflow.humanmanagement.model.dto.AttendanceDto$AttendanceInfo">
		SELECT
		    A.ATT_DATE,
		    M.USER_NAME,
		    D.DEP_NAME,
		    P.POS_NAME,
		    A.CHECK_IN_TIME,
		    A.CHECK_OUT_TIME,
		    A.STATUS
		FROM ATTENDANCE A
		LEFT JOIN MEMBER M ON M.USER_NO = A.USER_NO
		LEFT JOIN DEPARTMENT D ON D.DEP_ID = M.DEP_ID
		LEFT JOIN POSITIONS P ON P.POS_ID = M.POS_ID
		WHERE A.ATT_DATE = #{attDate}
		<if test="userNo != null">
			AND A.USER_NO = #{userNo}
		</if>
		ORDER BY A.ATT_DATE ASC
	</select>
	
	<!-- 로그인 사용자 근태 기록 조회(월별) -->
	<select id="perAttendance" resultType="com.kh.coreflow.humanmanagement.model.dto.AttendanceDto$AttendanceInfo">
		SELECT
			A.ATT_DATE,
		    M.USER_NAME,
		    D.DEP_NAME,
		    P.POS_NAME,
		    A.CHECK_IN_TIME,
		    A.CHECK_OUT_TIME,
		    A.STATUS
		FROM ATTENDANCE A
		LEFT JOIN MEMBER M ON M.USER_NO = A.USER_NO
		LEFT JOIN DEPARTMENT D ON D.DEP_ID = M.DEP_ID
		LEFT JOIN POSITIONS P ON P.POS_ID = M.POS_ID
		WHERE A.USER_NO = #{userNo} AND
			  EXTRACT(YEAR FROM TO_DATE(A.ATT_DATE, 'YYYY/MM/DD')) = #{year} AND
			  EXTRACT(MONTH FROM TO_DATE(A.ATT_DATE, 'YYYY/MM/DD')) = LPAD(#{month},2,'0')
		ORDER BY A.ATT_DATE ASC
	</select>
</mapper>