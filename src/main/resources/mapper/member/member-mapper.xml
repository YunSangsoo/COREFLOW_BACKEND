<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="member">

  <select id="searchMembers" parameterType="map"
          resultType="com.kh.coreflow.member.model.dto.MemberDto$MemberLite">
    SELECT
      USER_NO    AS userNo,
      DEP_ID     AS depId,
      POS_ID     AS posId,
      USER_NAME  AS userName,
      EMAIL      AS email
    FROM MEMBER
    WHERE NVL(STATUS,'T') = 'T'
      <if test="depId != null">
        AND DEP_ID = #{depId}
      </if>
      <if test="query != null and query != ''">
        AND (
          UPPER(USER_NAME) LIKE '%' || UPPER(#{query}) || '%'
          OR UPPER(EMAIL)  LIKE '%' || UPPER(#{query}) || '%'
        )
      </if>
    ORDER BY USER_NAME ASC
    <if test="limit != null">
      FETCH FIRST #{limit} ROWS ONLY
    </if>
  </select>
	
</mapper>











