<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="notice">

	<!-- 공지 리스트 조회 -->
	<select id="notiList" resultType="com.kh.coreflow.notice.model.dto.NoticeDto$NoticeResponse">
		SELECT
			N.NOTI_ID,
			M.USER_NAME,
			N.TITLE,
			N.ENROLL_DATE,
			N.ESSENTIAL
		FROM NOTICE N
		LEFT JOIN MEMBER M ON M.USER_NO = N.WRITER 
		WHERE
			N.STATUS = 'T'
			<if test="keyword != null and keyword != ''">
				<choose>
					<when test="searchType == 'title'">
						AND N.TITLE LIKE '%'||#{keyword}||'%'
					</when>
					<when test="searchType == 'content'">
						AND N.CONTENT LIKE '%'||#{keyword}||'%'
					</when>
					<when test="searchType == 'writer'">
						AND M.USER_NAME LIKE '%'||#{keyword}||'%'
					</when>
				</choose>
			</if>
		ORDER BY
			N.ESSENTIAL DESC,
			N.NOTI_ID DESC
	</select>
	
	<!-- 공지 등록(첨부파일) -->
	<insert id="notiInsert">
		<selectKey keyProperty="notiId" resultType="int" order="BEFORE">
			SELECT NOTI_ID_SEQ.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO NOTICE(NOTI_ID, WRITER, TITLE, CONTENT, ESSENTIAL
			<if test="insertParams.endDate != null and issertParams.endDate.isEmpty()">
				,END_DATE
			</if>
			<if test="insertParams.endTime != null and issertParams.endTime.isEmpty()">
				,END_TIME
			</if>
			<if test="insertParams.endDate != null and issertParams.endDate.isEmpty()">
				,DEP_ID
			</if>
			<if test="insertParams.endDate != null and issertParams.endDate.isEmpty()">
				,POS_ID
			</if>
		)
		VALUES(
			#{notiId},
			#{userNo},
			#{insertParams.title},
			#{insertParams.content},
			#{insertParams.essential},
			<if test="insertParams.endDate != null and !insertParams.endDate.isEmpty()">
				#{insertParams.endDate},			
			</if>
			<if test="insertParams.endTime != null and !insertParams.endTime.isEmpty()">
				#{insertParams.endTime},
			</if>
			<if test="insertParams.depId != null and !insertParams.depId.isEmpty()">
				#{insertParams.depId},
			</if>
			<if test="insertParams.posId != null and !insertParams.posId.isEmpty()">
				#{insertParams.posId},
			</if>
			)
	</insert>
</mapper>